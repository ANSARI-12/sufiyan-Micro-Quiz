<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro-Certification Portal</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- html2canvas and jspdf for certificate download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-100 font-sans antialiased">
    <div id="root"></div>

    <script type="text/babel">
        // This is the main App component, containing all the logic and UI
        // Note: For this platform, all components must reside in a single file to ensure immediate preview and portability.
        const App = () => {
            // A simple user data store, simulating a database
            const [users, setUsers] = React.useState([]);
            const [results, setResults] = React.useState([]);

            // Mock quiz data, simulating a database of questions
            const quizData = [
                {
                    id: 1,
                    questionText: 'What is React?',
                    options: ['A server-side framework', 'A programming language', 'A JavaScript library for building user interfaces', 'A database management system'],
                    correctAnswer: 'A JavaScript library for building user interfaces',
                },
                {
                    id: 2,
                    questionText: 'Which of the following is a way to handle events in React?',
                    options: ['addEventListener', 'onClick', 'onEvent', 'eventHandler'],
                    correctAnswer: 'onClick',
                },
                {
                    id: 3,
                    questionText: 'What is JSX?',
                    options: ['A special type of CSS', 'A syntax extension for JavaScript', 'A database query language', 'A Node.js module'],
                    correctAnswer: 'A syntax extension for JavaScript',
                },
                {
                    id: 4,
                    questionText: 'How do you create a React component?',
                    options: ['Using a class or function', 'Using an object', 'Using a for loop', 'Using an XML tag'],
                    correctAnswer: 'Using a class or function',
                },
                {
                    id: 5,
                    questionText: 'Which hook is used to manage state in a functional component?',
                    options: ['useEffect', 'useContext', 'useState', 'useReducer'],
                    correctAnswer: 'useState',
                },
            ];

            // State for application flow
            const [currentView, setCurrentView] = React.useState('login'); // 'login', 'quiz', 'results'
            const [user, setUser] = React.useState({ name: '', score: 0 });
            const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);
            const [userAnswers, setUserAnswers] = React.useState([]);
            const [quizComplete, setQuizComplete] = React.useState(false);

            // Handlers for the quiz flow
            const handleStartQuiz = () => {
                if (user.name.trim() !== '') {
                    setCurrentView('quiz');
                    // "Register" the new user in our mock DB
                    setUsers(prevUsers => [...prevUsers, { id: Date.now(), name: user.name }]);
                }
            };

            const handleOptionClick = (selectedOption) => {
                const newAnswers = [...userAnswers];
                newAnswers[currentQuestionIndex] = selectedOption;
                setUserAnswers(newAnswers);
            };

            const handleNext = () => {
                if (currentQuestionIndex < quizData.length - 1) {
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                } else {
                    calculateAndShowResults();
                }
            };

            const calculateAndShowResults = () => {
                let score = 0;
                userAnswers.forEach((answer, index) => {
                    if (answer === quizData[index].correctAnswer) {
                        score++;
                    }
                });
                setUser(prevUser => ({ ...prevUser, score: score }));
                
                // "Store" the result in our mock DB
                setResults(prevResults => [...prevResults, { userId: user.name, score: score, date: new Date().toISOString() }]);

                setQuizComplete(true);
                setCurrentView('results');
            };

            const handleDownloadCertificate = async () => {
                const certificateElement = document.getElementById('certificate');
                if (!certificateElement || !window.html2canvas || !window.jspdf.jsPDF) {
                    // This error is a dev-only check for missing dependencies
                    // It will not fire in this environment as the CDNs are correctly loaded.
                    return;
                }

                // Use html2canvas to capture the certificate div
                const canvas = await window.html2canvas(certificateElement, { scale: 2, logging: false });
                const imgData = canvas.toDataURL('image/png');

                // Create a PDF document from the captured image
                const pdf = new window.jspdf.jsPDF('landscape', 'px', 'a4');
                const width = pdf.internal.pageSize.getWidth();
                const height = pdf.internal.pageSize.getHeight();

                // The dimensions of the image must be correctly scaled
                const imgWidth = canvas.width;
                const imgHeight = canvas.height;
                const ratio = Math.min(width / imgWidth, height / imgHeight);

                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth * ratio, imgHeight * ratio);
                pdf.save('Certificate_of_Completion.pdf');
            };

            // Render different views based on the current state
            const renderView = () => {
                switch (currentView) {
                    case 'login':
                        return (
                            <div className="flex flex-col items-center justify-center h-screen p-8">
                                <div className="bg-white p-10 rounded-xl shadow-2xl max-w-lg w-full text-center space-y-6">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" className="text-6xl text-purple-600 mx-auto mb-4 w-16 h-16"><path fill="currentColor" d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.4 304 0 383.4 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.4 368.6 304 269.7 304H178.3z"/></svg>
                                    <h1 className="text-3xl font-bold text-gray-800">Micro-Certification Portal</h1>
                                    <p className="text-gray-600">Enter your name to start the quiz.</p>
                                    <input
                                        type="text"
                                        className="w-full p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-purple-500 transition-colors"
                                        placeholder="Your Name"
                                        value={user.name}
                                        onChange={(e) => setUser({ ...user, name: e.target.value })}
                                    />
                                    <button
                                        onClick={handleStartQuiz}
                                        className="w-full bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-purple-700 transition-all duration-300 transform hover:scale-105"
                                    >
                                        Start Quiz
                                    </button>
                                </div>
                            </div>
                        );
                    case 'quiz':
                        const currentQuestion = quizData[currentQuestionIndex];
                        return (
                            <div className="flex flex-col items-center justify-center h-screen p-8">
                                <div className="bg-white p-10 rounded-xl shadow-2xl max-w-3xl w-full">
                                    <div className="mb-6 text-center">
                                        <p className="text-purple-600 text-xl font-bold">Question {currentQuestionIndex + 1} of {quizData.length}</p>
                                        <h2 className="text-2xl font-bold text-gray-800 mt-4">{currentQuestion.questionText}</h2>
                                    </div>
                                    <div className="space-y-4">
                                        {currentQuestion.options.map((option, index) => (
                                            <button
                                                key={index}
                                                onClick={() => handleOptionClick(option)}
                                                className={`w-full text-left p-4 rounded-lg border-2 transition-all duration-200
                                                    ${userAnswers[currentQuestionIndex] === option
                                                        ? 'bg-purple-100 border-purple-500 text-purple-700 font-bold shadow-lg'
                                                        : 'bg-white border-gray-300 text-gray-700 hover:bg-gray-50'
                                                    }`}
                                            >
                                                {option}
                                            </button>
                                        ))}
                                    </div>
                                    <div className="mt-8 text-center">
                                        <button
                                            onClick={handleNext}
                                            className="bg-purple-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-purple-700 transition-all duration-300 transform hover:scale-105"
                                        >
                                            {currentQuestionIndex === quizData.length - 1 ? 'Submit' : 'Next'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        );
                    case 'results':
                        const isPassed = user.score >= Math.ceil(quizData.length * 0.7); // Pass if score is 70% or higher
                        return (
                            <div className="flex flex-col items-center justify-center min-h-screen p-8">
                                <div className="bg-white p-10 rounded-xl shadow-2xl max-w-3xl w-full text-center space-y-6">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" className="text-6xl text-yellow-500 mx-auto mb-4 w-16 h-16"><path fill="currentColor" d="M256 0C114.6 0 0 114.6 0 256S114.6 512 256 512s256-114.6 256-256S397.4 0 256 0zm0 128a128 128 0 1 1 0 256 128 128 0 1 1 0-256zM320 256a64 64 0 1 0 -128 0 64 64 0 1 0 128 0z"/></svg>
                                    <h1 className="text-4xl font-extrabold text-gray-800">Quiz Complete!</h1>
                                    <p className="text-xl font-semibold text-gray-700">Congratulations, <span className="text-purple-600">{user.name}</span>!</p>
                                    <p className="text-5xl font-bold text-purple-600">Your Score: {user.score} / {quizData.length}</p>
                                    <div className={`py-2 px-4 rounded-full text-white font-bold inline-block shadow-lg ${isPassed ? 'bg-green-500' : 'bg-red-500'}`}>
                                        {isPassed ? 'Passed' : 'Failed'}
                                    </div>
                                    {isPassed && (
                                        <div className="mt-8">
                                            <p className="text-gray-600 mb-4">You have successfully passed the quiz and are eligible for a certificate.</p>
                                            <button
                                                onClick={handleDownloadCertificate}
                                                className="bg-purple-600 text-white font-semibold py-3 px-8 rounded-lg shadow-md hover:bg-purple-700 transition-all duration-300 transform hover:scale-105 flex items-center justify-center mx-auto"
                                            >
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" className="w-5 h-5 mr-2" fill="currentColor"><path d="M256 0c17.7 0 32 14.3 32 32s-14.3 32-32 32C117.3 64 0 181.3 0 320c0 102.1 76.2 185.8 174.4 199.1c-1.1-1.6-2.4-3-3.6-4.5l-6.8-8.4c-9.4-11.6-18.1-23.7-25.9-36.2l-2.4-3.8c-1.3-2.1-2.7-4.1-4.2-6.1l-1.9-2.6c-4.8-6.6-9.2-13.6-13.2-20.9l-1.3-2.5c-3.1-5.7-6-11.7-8.6-17.9L73 400.9c-2.4-5.8-4.7-11.9-6.7-18.1L64 374c-2.1-6.2-4.1-12.7-5.9-19.1L57 348.6c-1.7-6.5-3.3-13.2-4.6-20L49.7 312c-1.3-6.8-2.5-13.7-3.4-20.7L46 288.9c-1-7.1-1.9-14.2-2.5-21.5l-1.4-18.7c-.5-6.1-.8-12.2-.9-18.4L41.9 224h18.1c16 0 31.8-3.4 46.4-10.1c1.5-.7 3-1.4 4.5-2.2c1.9-1.2 3.8-2.4 5.7-3.6c5.5-3.5 11.2-7.1 16.9-10.7c2.3-1.5 4.6-3 6.9-4.5c8.3-5.4 16.8-10.8 25.4-16.1c.9-.6 1.8-1.2 2.7-1.8c9.5-5.9 19.3-11.8 29.3-17.6c1.1-.6 2.1-1.2 3.2-1.8c10.3-5.9 20.8-11.8 31.5-17.5c2.1-1.1 4.2-2.2 6.3-3.3c11.3-5.9 22.8-11.7 34.5-17.4c.5-.3 1.1-.5 1.6-.8c12.2-5.7 24.6-11.3 37.2-16.8c13-5.6 26.2-10.9 39.5-16.1c.7-.3 1.4-.5 2.1-.8c13.7-5.2 27.6-10.3 41.7-15.2c14.2-4.9 28.5-9.6 42.9-14.2c.4-.1 .9-.3 1.3-.4c15.1-4.7 30.5-9.2 46-13.5c15.8-4.4 31.8-8.6 48-12.6c1.1-.3 2.1-.5 3.2-.7c16.3-3.7 32.8-7.3 49.3-10.7c1.4-.3 2.8-.5 4.3-.8c16.8-3.1 33.7-6.1 50.7-8.9c2.3-.4 4.6-.7 6.9-1.1c17.3-2.7 34.7-5.2 52.2-7.4c.4-.1 .8-.2 1.3-.2c17.5-2.2 35-4.1 52.6-5.8c.2 0 .4-.1 .6-.1c.5-.1 1-.1 1.5-.2c17.7-1.6 35.4-3.1 53.1-4.3c17.8-1.2 35.6-2.2 53.3-3c.2 0 .4-.1 .6-.1s.4-.1 .6-.1c18.1-.8 36.3-1.5 54.4-1.8c18.1-.3 36.3-.5 54.5-.5H544c17.7 0 32-14.3 32-32s-14.3-32-32-32H448zM320 224c0-17.7-14.3-32-32-32s-32 14.3-32 32s14.3 32 32 32s32-14.3 32-32zm-64 192c-53 0-96-43-96-96s43-96 96-96s96 43 96 96s-43 96-96 96z"/></svg>
                                                Download Certificate
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Hidden Certificate element for PDF generation */}
                                {isPassed && (
                                    <div id="certificate" className="absolute -left-[9999px] p-24 w-[1123px] h-[794px] bg-white border-8 border-purple-700 font-serif">
                                        <div className="flex flex-col items-center justify-center h-full text-center">
                                            <h1 className="text-6xl font-extrabold text-purple-800 mb-6 font-sans">CERTIFICATE OF ACHIEVEMENT</h1>
                                            <p className="text-3xl text-gray-600 font-semibold mb-2">This is to certify that</p>
                                            <h2 className="text-7xl font-bold text-purple-600 mb-8 font-serif">{user.name}</h2>
                                            <p className="text-3xl text-gray-600 font-semibold mb-2">has successfully completed the</p>
                                            <p className="text-5xl font-bold text-gray-800 mb-8 font-sans">LMS Micro-Certification</p>
                                            <div className="text-2xl text-gray-700 mt-auto">
                                                <p className="font-semibold">Date: {new Date().toLocaleDateString()}</p>
                                                <p className="font-semibold">Score: {user.score}/{quizData.length}</p>
                                                <p className="font-semibold">Signature: AGH Learning</p>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        );
                    default:
                        return null;
                }
            };

            return (
                <React.Fragment>
                    {renderView()}
                </React.Fragment>
            );
        };
        
        // This is the correct place to render the component to the DOM.
        // It should be outside of the component definition itself.
        const rootElement = document.getElementById('root');
        if (rootElement) {
            ReactDOM.createRoot(rootElement).render(<App />);
        }
    </script>
</body>
</html>
